<!DOCTYPE html>
<html>
  <body>
    <h1>Hello World</h1>
<script>
  (function(d,t) {
    var BASE_URL="https://uboschat-9694-693c0e8aecafd21100000227.dev.ubos.tech";
    var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
    g.src=BASE_URL+"/packs/js/sdk.js";
    g.defer = true;
    g.async = true;
    s.parentNode.insertBefore(g,s);
    g.onload=function(){
      window.chatwootSDK.run({
        websiteToken: 'PcQRGwvHWPAVv6zYaDKX9DE2',
        baseUrl: BASE_URL
      })
    }
  })(document,"script");
</script>
  <script>
  const currentUser = {
    id: "12345",
    name: "Валерія",
    email: "savyn@example.com",
    phone_number: "+79990000000",
  };

  function applyChatwootUser() {
    if (!window.$chatwoot) return false;

    console.log("Applying Chatwoot user", currentUser);

    window.$chatwoot.setUser(String(currentUser.id), {
      email: currentUser.email,
      phone_number: currentUser.phone_number,
    });

    window.$chatwoot.setCustomAttributes({
      user_id: String(currentUser.id),
      user_name: currentUser.name,
      user_email: currentUser.email,
      user_phone_number: currentUser.phone_number,
    });

    return true;
  }

  window.addEventListener("chatwoot:ready", function () {
    console.log("chatwoot:ready fired", !!window.$chatwoot);

    // пробуем сразу
    if (applyChatwootUser()) return;

    // если $chatwoot ещё не появился — ретраи
    let tries = 0;
    const t = setInterval(() => {
      tries++;
      if (applyChatwootUser() || tries > 20) clearInterval(t);
    }, 250);
  });
</script>
    </body>
</html>

