<!DOCTYPE html>
<html>
  <body>
    <h1>Hello World</h1>
<div>
  <button class="cw-btn" onclick="openChatwoot('Що ти вмієш?')">Що ти вмієш?</button>
</div>
<div>
  <button class="cw-btn" onclick="openChatwoot('Як справи?')">Як справи?</button>
</div>
<div>
  <button class="cw-btn" onclick="openChatwoot('Як тебе звати?')">Як тебе звати?</button>
</div>
<script>
  
  function getCookie(name) {
    const m = document.cookie.match(new RegExp('(?:^|; )' + name.replace(/([$?*|{}\]\\^])/g, '\\$1') + '=([^;]*)'));
    return m ? decodeURIComponent(m[1]) : null;
  }

  function waitForCookie(name, { timeout = 5000, interval = 100 } = {}) {
    return new Promise((resolve, reject) => {
      const start = Date.now();
      const timer = setInterval(() => {
        const val = getCookie(name);
        if (val) { clearInterval(timer); resolve(val); return; }
        if (Date.now() - start > timeout) {
          clearInterval(timer);
          reject(new Error(`Did not receive cookie ${name} within ${timeout} ms`));
        }
      }, interval);
    });
  }
function waitForChatwootReady({ timeout = 10000 } = {}) {
    return new Promise((resolve, reject) => {
      if (window.$chatwoot && typeof window.$chatwoot.toggle === 'function') return resolve();
      const onReady = () => { window.removeEventListener('chatwoot:ready', onReady); resolve(); };
      window.addEventListener('chatwoot:ready', onReady, { once: true });
      setTimeout(() => {
        window.removeEventListener('chatwoot:ready', onReady);
        reject(new Error('chatwoot:ready timeout'));
      }, timeout);
    });
  }

  async function ensureConversationCookie() {
    const existing = getCookie('cw_conversation');
    if (existing) return existing;

    await waitForChatwootReady();

    try {
      window.$chatwoot.toggle('open');
    } catch (e) {
      console.warn('Unable to open widget to trigger conversation:', e);
    }

    const cw = await waitForCookie('cw_conversation', { timeout: 10000, interval: 150 });

    try {
      window.$chatwoot.toggle('close');
    } catch (_) {}

    return cw;
  }
 async function openChatwoot(messageText) { 
   try   { 
     const cw = await ensureConversationCookie(); 
     const resp = await fetch( 'https://aibotv3-nr-5728-68e1c21ad94e811100000001.ubos-ksbve.ubos.tech/send-message', 
                              { method: 'POST', headers: { 'Content-Type': 'application/json' }, 
                               body: JSON.stringify({ cw_conversation: cw, text: String(messageText || '') }), 
                              } ); 
     if (resp.status !== 200) { 
        throw new Error(`The service returned error: ${resp.status}`);
     } 
     await waitForChatwootReady(); 
     window.$chatwoot.toggle('open'); 
   } catch (err) { 
     console.error('Chain failed (cookie → POST → open):', err); 
     if (window.$chatwoot && typeof window.$chatwoot.toggle === 'function') { 
       window.$chatwoot.toggle('open'); 
     } 
   } 
 }
      (function(d,t) {
        var BASE_URL="https://uboschat-4382-68e1c21ad94e811100000001.ubos-ksbve.ubos.tech";
        var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
        g.src=BASE_URL+"/packs/js/sdk.js";
        g.async = true;
        s.parentNode.insertBefore(g,s);
        g.onload=function(){
          window.chatwootSDK.run({
            websiteToken: 'A74jUhxecnBMKhCzCaKz4CAQ',
            baseUrl: BASE_URL
          })
        }
      })(document,"script");
     </script>

     <style>
      .cw-btn {
        padding: 10px 16px;
        margin: 6px 8px 0 0;
        border: 0;
        border-radius: 8px;
        cursor: pointer;
        font: 600 16px/1.2 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        background: #2f6fec; color: #fff;
      }
      .cw-btn:hover { opacity: 0.9; }
    </style>
  </body>
</html>

